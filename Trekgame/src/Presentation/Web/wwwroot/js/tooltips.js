// Game Tooltip System
window.GameTooltips = (function() {
    let tooltipComponent = null;
    let showTimeout = null;
    let hideTimeout = null;
    
    // Tooltip data definitions
    const tooltipData = {
        // Resources
        'resource-credits': {
            title: 'Credits',
            content: 'The primary currency used for construction, maintenance, and trade. Generated by colonies and trade routes.',
            hint: 'Build Trading Posts to increase income',
            stats: [
                { icon: 'ðŸ­', name: 'From Colonies', value: '+45/turn', positive: true },
                { icon: 'ðŸ“¦', name: 'Trade Routes', value: '+12/turn', positive: true },
                { icon: 'ðŸ”§', name: 'Maintenance', value: '-18/turn', negative: true }
            ]
        },
        'resource-dilithium': {
            title: 'Dilithium',
            content: 'Rare crystal used to regulate matter/antimatter reactions in warp cores. Essential for ship construction.',
            hint: 'Found in asteroid fields and some planets'
        },
        'resource-duranium': {
            title: 'Duranium',
            content: 'Heavy metal alloy used in ship hulls and defensive structures. Mined from planetary deposits.',
            hint: 'Build Mining Facilities to increase production'
        },
        'resource-research': {
            title: 'Research Points',
            content: 'Scientific output used to unlock new technologies. Generated by laboratories and science vessels.',
            hint: 'Assign scientists to labs for bonus output'
        },
        
        // Ship Classes
        'ship-scout': {
            title: 'Scout',
            content: 'Fast reconnaissance vessel ideal for exploration. Lightly armed but highly maneuverable.',
            stats: [
                { icon: 'âš”', name: 'Attack', value: '30' },
                { icon: 'ðŸ›¡', name: 'Defense', value: '15' },
                { icon: 'ðŸ’¨', name: 'Speed', value: '18' }
            ]
        },
        'ship-destroyer': {
            title: 'Destroyer',
            content: 'Light combat vessel designed for patrol and escort duties. Good balance of firepower and speed.',
            stats: [
                { icon: 'âš”', name: 'Attack', value: '60' },
                { icon: 'ðŸ›¡', name: 'Defense', value: '30' },
                { icon: 'ðŸ’¨', name: 'Speed', value: '12' }
            ]
        },
        'ship-cruiser': {
            title: 'Cruiser',
            content: 'Main battle vessel forming the backbone of any fleet. Versatile and well-armored.',
            stats: [
                { icon: 'âš”', name: 'Attack', value: '100' },
                { icon: 'ðŸ›¡', name: 'Defense', value: '50' },
                { icon: 'ðŸ’¨', name: 'Speed', value: '8' }
            ]
        },
        'ship-battleship': {
            title: 'Battleship',
            content: 'Heavy warship with devastating firepower. Slow but extremely powerful in combat.',
            stats: [
                { icon: 'âš”', name: 'Attack', value: '200' },
                { icon: 'ðŸ›¡', name: 'Defense', value: '100' },
                { icon: 'ðŸ’¨', name: 'Speed', value: '5' }
            ]
        },
        
        // Buildings
        'building-shipyard': {
            title: 'Orbital Shipyard',
            content: 'Enables construction of starships at this colony. Higher levels allow larger ship classes.',
            hint: 'Upgrade to build capital ships'
        },
        'building-research-lab': {
            title: 'Research Laboratory',
            content: 'Facility dedicated to scientific research. Increases research output of the colony.',
            stats: [
                { icon: 'ðŸ”¬', name: 'Research', value: '+10', positive: true },
                { icon: 'ðŸ’°', name: 'Maintenance', value: '-5/turn', negative: true }
            ]
        },
        'building-factory': {
            title: 'Industrial Complex',
            content: 'Manufacturing facility that increases production capacity.',
            stats: [
                { icon: 'ðŸ­', name: 'Production', value: '+15', positive: true }
            ]
        },
        
        // Game Actions
        'action-end-turn': {
            title: 'End Turn',
            content: 'Submit your orders and advance to the next turn. All queued actions will be processed.',
            hint: 'Make sure all fleets have orders!'
        },
        'action-research': {
            title: 'Select Research',
            content: 'Choose a technology to research. Progress is made each turn based on your science output.'
        },
        
        // Diplomacy
        'diplomacy-trade': {
            title: 'Trade Agreement',
            content: 'Establish trade routes between empires, providing mutual economic benefits.',
            stats: [
                { icon: 'ðŸ’°', name: 'Credits', value: '+10/turn', positive: true },
                { icon: 'ðŸ‘', name: 'Opinion', value: '+25', positive: true }
            ]
        },
        'diplomacy-nap': {
            title: 'Non-Aggression Pact',
            content: 'A formal agreement to refrain from hostile actions. Provides security but limits expansion options.',
            stats: [
                { icon: 'ðŸ‘', name: 'Opinion', value: '+15', positive: true }
            ]
        },
        'diplomacy-alliance': {
            title: 'Defensive Alliance',
            content: 'Military alliance providing mutual defense. Allies will join wars if either is attacked.',
            stats: [
                { icon: 'ðŸ‘', name: 'Opinion', value: '+50', positive: true },
                { icon: 'âš”', name: 'Defense', value: 'Shared' }
            ]
        }
    };
    
    function init(componentRef) {
        tooltipComponent = componentRef;
        
        // Add event listeners to elements with data-tooltip attribute
        document.addEventListener('mouseover', handleMouseOver);
        document.addEventListener('mouseout', handleMouseOut);
        document.addEventListener('mousemove', handleMouseMove);
    }
    
    function handleMouseOver(e) {
        const target = e.target.closest('[data-tooltip]');
        if (!target) return;
        
        clearTimeout(hideTimeout);
        
        showTimeout = setTimeout(() => {
            const tooltipKey = target.getAttribute('data-tooltip');
            const data = tooltipData[tooltipKey];
            
            if (data && tooltipComponent) {
                tooltipComponent.invokeMethodAsync('Show', 
                    e.clientX, 
                    e.clientY, 
                    data.title || '',
                    data.content || '',
                    data.hint || '',
                    data.stats || null
                );
            } else if (tooltipComponent) {
                // Fallback for custom tooltips via data attributes
                tooltipComponent.invokeMethodAsync('Show',
                    e.clientX,
                    e.clientY,
                    target.getAttribute('data-tooltip-title') || '',
                    target.getAttribute('data-tooltip-content') || tooltipKey,
                    target.getAttribute('data-tooltip-hint') || '',
                    null
                );
            }
        }, 300);
    }
    
    function handleMouseOut(e) {
        const target = e.target.closest('[data-tooltip]');
        if (!target) return;
        
        clearTimeout(showTimeout);
        
        hideTimeout = setTimeout(() => {
            if (tooltipComponent) {
                tooltipComponent.invokeMethodAsync('Hide');
            }
        }, 100);
    }
    
    function handleMouseMove(e) {
        if (tooltipComponent) {
            tooltipComponent.invokeMethodAsync('Move', e.clientX, e.clientY);
        }
    }
    
    return {
        init: init,
        addTooltipData: function(key, data) {
            tooltipData[key] = data;
        }
    };
})();
